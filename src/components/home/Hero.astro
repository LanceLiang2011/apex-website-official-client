---
import type { Locale } from '../../data/types';
import { getRelativeLocaleUrl } from 'astro:i18n';
import { content } from '../../data/content';

interface Props {
  locale: Locale;
}
const { locale } = Astro.props;

const slides = content.home.hero.slides.map(slide => ({
  image: slide.image,
  title: slide.title[locale],
  subtitle: slide.subtitle[locale],
  cta: slide.cta[locale],
  link: slide.link
}));
---

<section class="relative h-[600px] overflow-hidden group">
  <!-- Slides -->
  <div id="hero-slider" class="h-full w-full relative">
    {slides.map((slide, index) => (
      <div class={`absolute inset-0 transition-opacity duration-1000 ease-in-out ${index === 0 ? 'opacity-100 z-10' : 'opacity-0 z-0'} slide-item`} data-index={index}>
        <!-- Background Image -->
        <div class={`absolute inset-0 bg-cover ${index < 2 ? 'bg-center' : 'bg-top'}`} style={`background-image: url('${slide.image}')`}></div>
        <!-- Overlay -->
        <div class="absolute inset-0 bg-gradient-to-r from-black/80 to-transparent"></div>
        
        <!-- Content -->
        <div class="container mx-auto px-4 h-full flex items-center relative z-20">
          <div class="max-w-2xl text-white">
            <h1 class="text-4xl md:text-6xl font-bold mb-6 leading-tight animate-fade-in-up">
              {slide.title}
            </h1>
            <p class="text-lg md:text-xl mb-8 text-gray-200 animate-fade-in-up delay-100">
              {slide.subtitle}
            </p>
            <a 
              href={getRelativeLocaleUrl(locale, slide.link)} 
              class="inline-block bg-red-600 hover:bg-red-700 text-white font-semibold px-8 py-4 rounded-lg transition-all transform hover:translate-y-[-2px] hover:shadow-lg animate-fade-in-up delay-200"
            >
              {slide.cta}
            </a>
          </div>
        </div>
      </div>
    ))}
  </div>

  <!-- Indicators -->
  <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2 z-30 flex gap-3">
    {slides.map((_, index) => (
      <button 
        class={`w-3 h-3 rounded-full transition-colors ${index === 0 ? 'bg-red-600' : 'bg-white/50 hover:bg-white'}`}
        data-slide-to={index}
        aria-label={`Go to slide ${index + 1}`}
      ></button>
    ))}
  </div>
</section>

<style>
  .animate-fade-in-up {
    animation: fadeInUp 0.8s ease-out forwards;
    opacity: 0;
    transform: translateY(20px);
  }
  
  .delay-100 { animation-delay: 0.1s; }
  .delay-200 { animation-delay: 0.2s; }

  @keyframes fadeInUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>

<script>
  const slides = document.querySelectorAll('.slide-item');
  const indicators = document.querySelectorAll('[data-slide-to]');
  let currentIndex = 0;
  const intervalTime = 5000;
  let slideInterval: number;

  function showSlide(index: number) {
    slides.forEach((slide, i) => {
      if (i === index) {
        slide.classList.remove('opacity-0', 'z-0');
        slide.classList.add('opacity-100', 'z-10');
      } else {
        slide.classList.remove('opacity-100', 'z-10');
        slide.classList.add('opacity-0', 'z-0');
      }
    });

    indicators.forEach((ind, i) => {
      if (i === index) {
        ind.classList.remove('bg-white/50');
        ind.classList.add('bg-red-600');
      } else {
        ind.classList.add('bg-white/50');
        ind.classList.remove('bg-red-600');
      }
    });

    currentIndex = index;
  }

  function nextSlide() {
    const nextIndex = (currentIndex + 1) % slides.length;
    showSlide(nextIndex);
  }

  function startSlider() {
    slideInterval = window.setInterval(nextSlide, intervalTime);
  }

  function stopSlider() {
    window.clearInterval(slideInterval);
  }

  // Event Listeners
  indicators.forEach(ind => {
    ind.addEventListener('click', (e) => {
      stopSlider();
      const index = parseInt((e.target as HTMLElement).dataset.slideTo || '0');
      showSlide(index);
      startSlider();
    });
  });

  // Start
  startSlider();
</script>
