---
import type { Locale } from '../data/types';
import { content as siteContent } from '../data/content';

const locale = (Astro.currentLocale || 'zh') as Locale;
const { scanText, subText } = siteContent.qrFloat;
---

<div id="qr-float" class="fixed right-0 bottom-20 z-50 group transition-transform duration-300 ease-in-out translate-x-0">
  <div class="flex items-center shadow-lg rounded-l-lg overflow-hidden">
    <!-- Toggle Button (Chevron) -->
    <button id="qr-toggle" class="bg-accent-red text-white w-8 h-32 flex items-center justify-center cursor-pointer hover:bg-red-700 transition-colors focus:outline-none" aria-label="Toggle QR Code">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 transform transition-transform duration-300" id="qr-chevron" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg>
    </button>

    <!-- Content (Main Panel) -->
    <div class="bg-white p-4 w-32 h-32 flex flex-col items-center justify-center border-l border-gray-100">
      <img src="/images/qr.jpeg" alt="WeChat QR Code" class="w-24 h-24 object-contain mb-1" />
      <p class="text-xs text-gray-600 font-medium text-center">{subText[locale]}</p>
    </div>
  </div>
</div>

<script>
  const qrFloat = document.getElementById('qr-float');
  const qrToggle = document.getElementById('qr-toggle');
  const qrChevron = document.getElementById('qr-chevron');
  let isOpen = true;

  function toggleQr() {
    isOpen = !isOpen;
    if (isOpen) {
      qrFloat?.classList.remove('translate-x-[calc(100%-32px)]');
      qrFloat?.classList.add('translate-x-0');
      qrChevron?.classList.remove('rotate-180');
    } else {
      qrFloat?.classList.remove('translate-x-0');
      qrFloat?.classList.add('translate-x-[calc(100%-32px)]');
      qrChevron?.classList.add('rotate-180');
    }
  }

  qrToggle?.addEventListener('click', toggleQr);
</script>
